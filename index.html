<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Family Gift Exchange üéÅ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .progress {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 10px 20px;
            display: inline-block;
            color: white;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            color: white;
        }

        .instructions h3 {
            margin-bottom: 15px;
            color: #ffd700;
        }

        .instructions ol {
            margin-left: 20px;
            line-height: 1.6;
        }

        .privacy-notice {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid rgba(255, 193, 7, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: white;
            text-align: center;
            font-weight: bold;
        }

        .limitation-notice {
            background: rgba(156, 39, 176, 0.2);
            border: 2px solid rgba(156, 39, 176, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: white;
            text-align: center;
            font-size: 0.9rem;
        }

        .device-notice {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid rgba(244, 67, 54, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: white;
            text-align: center;
            font-weight: bold;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: white;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .name-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .name-btn.selected {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            animation: pulse 2s infinite;
        }

        .name-btn.completed {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            position: relative;
        }

        .name-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #4CAF50;
            color: white;
            font-size: 1.2rem;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
        }

        .name-btn:disabled {
            cursor: not-allowed;
            transform: none !important;
        }

        .number-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .number-btn:disabled {
            background: linear-gradient(45deg, #9E9E9E, #757575);
            cursor: not-allowed;
            transform: none !important;
        }

        .number-btn.own {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            position: relative;
        }

        .number-btn.own::after {
            content: 'YOU';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF5722;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4); }
            50% { box-shadow: 0 4px 25px rgba(255, 107, 53, 0.8); }
            100% { box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4); }
        }

        .hidden {
            display: none;
        }

        .result {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid rgba(76, 175, 80, 0.5);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin-top: 20px;
            animation: slideIn 0.5s ease-out;
        }

        .result.error {
            background: rgba(244, 67, 54, 0.2);
            border-color: rgba(244, 67, 54, 0.5);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .celebration {
            text-align: center;
            padding: 40px;
            color: white;
        }

        .celebration h2 {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #FFD700;
        }

        .celebration p {
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .refresh-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .btn {
                padding: 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üéÅ Secret Gift Exchange ü§´</h1>
            <p class="subtitle">Family Christmas Gift Exchange 2024</p>
            <div class="progress" id="progress">Completed: 0/8</div>
            <button class="refresh-btn" onclick="refreshState()">üîÑ Refresh Status</button>
        </div>

        <div id="main-content">
            <div class="instructions">
                <h3>üìã How It Works:</h3>
                <ol>
                    <li><strong>Click your name</strong> from the family members below</li>
                    <li><strong>Choose a number</strong> from the available options (1-8)</li>
                    <li><strong>See who you're giving to</strong> - keep it secret! ü§ê</li>
                </ol>
            </div>

            <div class="privacy-notice">
                ‚ö†Ô∏è Numbers are randomly shuffled! You can't predict who you'll get!
            </div>

            <div class="limitation-notice">
                üì± <strong>Important:</strong> For true cross-device sync, this app would need a backend database. 
                Currently, completed selections are saved locally. Click "Refresh Status" to check for updates, 
                or coordinate with family members to avoid conflicts.
            </div>

            <div class="device-notice" id="device-notice" style="display: none;">
                üö´ This browser has already been used to make a selection. Each browser session can only be used once to prevent conflicts.
            </div>

            <div class="section">
                <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Select Your Name</h3>
                <div class="grid" id="names-grid">
                    <button class="btn name-btn" data-name="Mum">Mum</button>
                    <button class="btn name-btn" data-name="Dad">Dad</button>
                    <button class="btn name-btn" data-name="Sherry">Sherry</button>
                    <button class="btn name-btn" data-name="Nancy">Nancy</button>
                    <button class="btn name-btn" data-name="B">B</button>
                    <button class="btn name-btn" data-name="Pius">Pius</button>
                    <button class="btn name-btn" data-name="Kui">Kui</button>
                    <button class="btn name-btn" data-name="Turi">Turi</button>
                </div>
            </div>

            <div class="section hidden" id="numbers-section">
                <h3>üî¢ Choose Your Secret Number</h3>
                <div class="grid" id="numbers-grid">
                    <button class="btn number-btn" data-number="1">1</button>
                    <button class="btn number-btn" data-number="2">2</button>
                    <button class="btn number-btn" data-number="3">3</button>
                    <button class="btn number-btn" data-number="4">4</button>
                    <button class="btn number-btn" data-number="5">5</button>
                    <button class="btn number-btn" data-number="6">6</button>
                    <button class="btn number-btn" data-number="7">7</button>
                    <button class="btn number-btn" data-number="8">8</button>
                </div>
            </div>

            <div id="result-container"></div>
        </div>

        <div id="celebration" class="celebration hidden">
            <h2>üéâ Everyone's Done! üéâ</h2>
            <p>All 8 family members have made their selections!</p>
            <p>Time to start shopping for your secret person! üõçÔ∏è</p>
            <p><em>The gift exchange is now complete for everyone!</em></p>
        </div>
    </div>

    <script>
        const familyMembers = ['Mum', 'Dad', 'Sherry', 'Nancy', 'B', 'Pius', 'Kui', 'Turi'];
        let selectedPlayer = null;

        // Generate a more persistent browser fingerprint
        function getBrowserFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('Browser fingerprint', 2, 2);
            
            const fingerprint = [
                navigator.userAgent,
                navigator.language,
                screen.width + 'x' + screen.height,
                new Date().getTimezoneOffset(),
                canvas.toDataURL()
            ].join('|');
            
            // Create a hash of the fingerprint
            let hash = 0;
            for (let i = 0; i < fingerprint.length; i++) {
                const char = fingerprint.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return 'browser_' + Math.abs(hash).toString(36);
        }

        // Load game state from localStorage
        function loadGameState() {
            const saved = localStorage.getItem('giftExchangeState');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error('Error parsing saved state:', e);
                }
            }
            return {
                completedPlayers: [],
                usedNumbers: [],
                totalCompleted: 0,
                secretMapping: {},
                initialized: false,
                usedFingerprints: []
            };
        }

        // Save game state to localStorage
        function saveGameState(gameState) {
            localStorage.setItem('giftExchangeState', JSON.stringify(gameState));
        }

        // Check if browser has been used
        function hasBrowserBeenUsed(gameState, fingerprint) {
            return gameState.usedFingerprints.includes(fingerprint);
        }

        // Mark browser as used
        function markBrowserUsed(gameState, fingerprint) {
            if (!gameState.usedFingerprints.includes(fingerprint)) {
                gameState.usedFingerprints.push(fingerprint);
            }
        }

        let gameState = loadGameState();
        const browserFingerprint = getBrowserFingerprint();

        // Initialize secret mapping on first load
        function initializeSecretMapping() {
            if (gameState.initialized) return;
            
            // Create a shuffled copy of family members
            const shuffled = [...familyMembers];
            
            // Fisher-Yates shuffle algorithm
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            // Map numbers 1-8 to shuffled names
            shuffled.forEach((name, index) => {
                gameState.secretMapping[index + 1] = name;
            });
            
            gameState.initialized = true;
            saveGameState(gameState);
            console.log('Secret mapping initialized');
        }

        function updateProgress() {
            document.getElementById('progress').textContent = 
                `Completed: ${gameState.totalCompleted}/8`;
        }

        function updateNameButtons() {
            const nameButtons = document.querySelectorAll('.name-btn');
            nameButtons.forEach(btn => {
                const name = btn.dataset.name;
                btn.classList.remove('completed', 'selected');
                
                if (gameState.completedPlayers.includes(name)) {
                    btn.classList.add('completed');
                    btn.disabled = true;
                }
                
                if (selectedPlayer === name) {
                    btn.classList.add('selected');
                }
            });
        }

        function updateNumberButtons() {
            const numberButtons = document.querySelectorAll('.number-btn');
            numberButtons.forEach(btn => {
                const number = parseInt(btn.dataset.number);
                btn.disabled = false;
                btn.classList.remove('own');
                
                // Disable used numbers
                if (gameState.usedNumbers.includes(number)) {
                    btn.disabled = true;
                }
                
                // Mark and disable player's own number
                if (selectedPlayer) {
                    const playerIndex = familyMembers.indexOf(selectedPlayer);
                    if (number === playerIndex + 1) {
                        btn.classList.add('own');
                        btn.disabled = true;
                    }
                }
            });
        }

        function showResult(message, isError = false) {
            const container = document.getElementById('result-container');
            container.innerHTML = `
                <div class="result ${isError ? 'error' : ''}">
                    ${message}
                </div>
            `;
        }

        function checkCompletion() {
            if (gameState.totalCompleted >= 8) {
                document.getElementById('main-content').classList.add('hidden');
                document.getElementById('celebration').classList.remove('hidden');
            }
        }

        function refreshState() {
            // Reload from localStorage in case another tab/device updated it
            const newState = loadGameState();
            if (JSON.stringify(newState) !== JSON.stringify(gameState)) {
                gameState = newState;
                updateProgress();
                updateNameButtons();
                updateNumberButtons();
                checkCompletion();
                showResult('‚úÖ Status refreshed! Latest updates loaded.', false);
                setTimeout(() => {
                    document.getElementById('result-container').innerHTML = '';
                }, 3000);
            } else {
                showResult('‚ÑπÔ∏è No new updates found.', false);
                setTimeout(() => {
                    document.getElementById('result-container').innerHTML = '';
                }, 2000);
            }
        }

        function selectName(name) {
            // Check if browser has been used
            if (hasBrowserBeenUsed(gameState, browserFingerprint)) {
                document.getElementById('device-notice').style.display = 'block';
                showResult(`‚ùå This browser has already been used for the gift exchange. Each browser session can only be used once to prevent conflicts.`, true);
                return;
            }

            if (gameState.completedPlayers.includes(name)) {
                showResult(`‚ùå ${name} has already completed their selection!`, true);
                return;
            }
            
            selectedPlayer = name;
            document.getElementById('numbers-section').classList.remove('hidden');
            updateNameButtons();
            updateNumberButtons();
            
            showResult(`‚úÖ Selected: ${name}. Now choose your secret number!`);
        }

        function selectNumber(number) {
            if (!selectedPlayer) {
                showResult('‚ùå Please select your name first!', true);
                return;
            }
            
            if (gameState.usedNumbers.includes(number)) {
                showResult('‚ùå This number is already taken!', true);
                return;
            }
            
            // Check if trying to select own number
            const playerIndex = familyMembers.indexOf(selectedPlayer);
            if (number === playerIndex + 1) {
                showResult('‚ùå You cannot choose your own number!', true);
                return;
            }
            
            // Get recipient from secret mapping
            const recipient = gameState.secretMapping[number];
            
            // Update game state
            gameState.completedPlayers.push(selectedPlayer);
            gameState.usedNumbers.push(number);
            gameState.totalCompleted++;
            
            // Mark browser as used
            markBrowserUsed(gameState, browserFingerprint);
            
            // Save updated state
            saveGameState(gameState);
            
            // Show result
            showResult(`
                üéÅ <strong>${selectedPlayer}</strong>, you are giving a gift to:<br>
                <strong style="font-size: 1.4em; color: #FFD700;">${recipient}</strong><br>
                <em>Remember to keep it secret! ü§´</em><br><br>
                <small>üí° Other family members can now see that ${selectedPlayer} has completed their selection.</small>
            `);
            
            // Update UI
            updateProgress();
            updateNameButtons();
            updateNumberButtons();
            
            // Reset selection
            selectedPlayer = null;
            document.getElementById('numbers-section').classList.add('hidden');
            
            // Check if game is complete
            setTimeout(checkCompletion, 3000);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize if needed
            initializeSecretMapping();
            
            // Check if browser has been used
            if (hasBrowserBeenUsed(gameState, browserFingerprint)) {
                document.getElementById('device-notice').style.display = 'block';
                // Disable all name buttons that aren't completed
                document.querySelectorAll('.name-btn').forEach(btn => {
                    if (!gameState.completedPlayers.includes(btn.dataset.name)) {
                        btn.disabled = true;
                    }
                });
            }
            
            updateProgress();
            updateNameButtons();
            checkCompletion();
            
            // Name button listeners
            document.querySelectorAll('.name-btn').forEach(btn => {
                btn.addEventListener('click', () => selectName(btn.dataset.name));
            });
            
            // Number button listeners
            document.querySelectorAll('.number-btn').forEach(btn => {
                btn.addEventListener('click', () => selectNumber(parseInt(btn.dataset.number)));
            });
        });
    </script>
</body>
</html>